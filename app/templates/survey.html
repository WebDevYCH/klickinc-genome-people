{% macro render_form(form, category) %}
{% for field in form %}
<!-- {% if field.description == category %} -->
{% if field.type == "CSRFTokenField" %}
<p>
    {{ field }}
</p>
{% elif field.type == "SubmitField" %}
<p>
    {{ field (class_="btn btn-primary")}}
</p>
{% elif field.type == "MultiCheckboxField" %}
<div class="input-group">
    <p>
        {{ field.label }}</br>
        {% for value, label, _ in field.iter_choices() %}
        <label class="checkbox-inline">
            <input type="checkbox" name="{{ field.id }}" id="{{ field.id }}" value="{{ value }}">{{ label }}
        </label>
        {% endfor %}
        {% for error in field.errors %}
        <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
    </p>
</div>
{% elif field.type == "RadioField" %}
<div class="input-group">
    <p>
        {{ field.label }}</br>
        {% for value, label, _ in field.iter_choices() %}
        <label class="radio-inline">
            <input type="radio" name="{{ field.id }}" id="{{ field.id }}" value="{{ value }}">{{ label }}
        </label>
        {% endfor %}
        {% for error in field.errors %}
        <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
    </p>
</div>
{% else %}
<div class="input-group">
    <p>
        {{ field.label }}
        {{ field (class_="form-control")}}
        {% for error in field.errors %}
        <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
    </p>
</div>
{% endif %}
<!-- {% endif %} -->
{% endfor %}
{% endmacro %}

{% extends "base.html" %}

{% block app_content %}



<h1>Surveys</h1>
<!-- Latest compiled and minified Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<form id="survey" action="" method="post">
    {{ form.hidden_tag() }}
    <div class="container">
        <div class="panel-group" id="accordion">
            {% for survey in surveys %}
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion"
                            href="#accordion{{ loop.index }}">
                            <h3>{{ survey.name }}( {{ survey.start_date }} ~ {{ survey.end_date }} )</h3>
                        </a>
                    </h4>
                </div>
                <div id="accordion{{ loop.index }}" class="panel-collapse collapse">
                    <div class="panel-body">
                        <ul class="nav nav-tabs">
                            {% for category in categories %}
                            <li><a data-toggle="tab" href="#tab{{loop.index}}">{{ category }}</a></li>
                            {% endfor %}
                        </ul>
                        
                        <div class="tab-content">
                            {% for category in categories %}
                            <div id="tab{{loop.index}}" class="tab-pane fade">
                                {{ render_form(form, category) }}
                            </div>
                            {% endfor %}
                        </div>
                        <button class="btn btn-primary pull-right send-btn">Send</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div> <!-- end container -->
</form>
{% endblock %}


{% block scripts %}
<!-- Latest compiled and minified JavaScript -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
{{ super() }}
<script>
    $(".send-btn").on("click", function() {
        var formArray = $('#survey').serializeArray();
        var formObject = objectifyForm(formArray);
        console.log(formObject);
        $.ajax({
            url: '/save',
            data: formObject,
            type: "POST",
        })
    });
    function objectifyForm(formArray) { // make object from array
        var returnObject = {};
        for (var i = 0; i < formArray.length; i++) {
            returnObject[formArray[i]['name']] = formArray[i]['value'];
        }
        return returnObject;
    }
</script>
{% endblock %}
